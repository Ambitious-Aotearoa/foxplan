{% extends "_boilerplate/_layouts/layout-base.twig" %}

{# 1. Navigation Theme Setup #}
{% set navigationTheme = {
    backgroundColor: 'bg-foxplan-charcoal-brown',
    textColor: 'text-foxplan-yellow',
    searchBgColor: 'bg-foxplan-charcoal-brown',
    ctaBgColor: 'bg-foxplan-yellow',
    iconColor: 'text-foxplan-yellow',
} %}

{% block blockAppBody %}

    {# Hero Section (Original Styles) #}
    <section class="w-full bg-foxplan-charcoal-brown text-foxplan-yellow pt-24 pb-24 px-8 md:px-12 lg:px-16">
        <div class="max-w-7xl">
            <h1 class="font-serif text-7xl md:text-8xl lg:text-9xl mb-8 tracking-tight leading-none text-left">
                Our suppliers
            </h1>
            <p class="font-aktiv-grotesk text-xl md:text-2xl max-w-2xl leading-relaxed opacity-90 text-left">
                We partner with leading financial institutions to ensure you get the best possible outcomes for your investments, insurance, and lending needs.
            </p>
        </div>
    </section>

    {# --- DYNAMIC DATA FETCHING --- #}
    {% set tabDefinitions = [
        { id: 'investmentsKiwisaver', label: 'Investments & Kiwisaver' },
        { id: 'insurance', label: 'Insurance' },
        { id: 'mortgages', label: 'Mortgages' },
        { id: 'nonBankLenders', label: 'Non bank lenders' }
    ] %}

    {% set supplierTabs = [] %}

    {% for tab in tabDefinitions %}
        {# CRITICAL FIX: The section handle is 'ourSuppliers' #}
        {# The field handle is 'supplierCategory' #}
        {% set suppliersForTab = craft.entries()
            .section('ourSuppliers')
            .supplierCategory(tab.id)
            .all() %}

        {% set supplierTabs = supplierTabs|merge([{
            id: tab.id,
            label: tab.label,
            title: tab.label,
            suppliers: suppliersForTab
        }]) %}
    {% endfor %}

    {% set supplierData = {
        tabs: supplierTabs
    } %}

    {# 2. Interactive Section Wrapper #}
    <div x-data="{ activeTab: 'investmentsKiwisaver' }" class="bg-foxplan-yellow">

        {# Tabs Component #}
        {% include '_components/ui/tabs/tabs-services.twig' with {
            props: {
                tabs: supplierData.tabs,
                navBg: 'bg-foxplan-charcoal-brown',
                activeBg: 'bg-foxplan-neutral-beige',
                activeText: 'text-foxplan-charcoal-brown',
                inactiveText: 'text-foxplan-yellow/60',
                hoverText: 'hover:text-foxplan-yellow',
            }
        } only %}

        {# Suppliers Section #}
        {% include '_sections/content-sections/suppliers.twig' with {
            data: supplierData
        } only %}

    </div>

    {# 3. Footer #}
    {{ include('_components/footer/footer-High-fidelity.twig', {
        props: {
            backgroundColor: 'bg-foxplan-yellow',
            textColor: 'text-foxplan-charcoal-brown',
            logoColor: 'text-foxplan-charcoal-brown',
            buttonColor: 'bg-foxplan-charcoal-brown',
            buttonTextColor: 'text-foxplan-yellow',
            foxplanText: 'foxplan',
            borderTopColor: 'border-foxplan-charcoal-brown/20',
            borderTopWidth: 'border-t-2'
        }
    }) }}



{% endblock %}