{# templates/pages/Insights/index.twig #}
{% extends "_boilerplate/_layouts/layout-base.twig" %}

{% set navigationTheme = {
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown',
    searchBgColor: 'bg-foxplan-charcoal-brown',
    ctaBgColor: 'bg-foxplan-charcoal-brown',
    iconColor: 'text-foxplan-yellow',
} %}

{% block blockAppBody %}
    {# 1. FETCH CATEGORIES (From the group you mapped in Feed Me) #}
    {% set dynamicCategories = craft.categories.group('articleCategories').all() %}

    {# Determine the default active tab - usually the first category imported #}
    {% set firstCategorySlug = dynamicCategories|length ? dynamicCategories[0].slug : '' %}

    {# 2. HERO SECTION #}
    <section class="w-full bg-foxplan-yellow text-foxplan-charcoal-brown pt-32 pb-24 px-8 md:px-16">
        <h1 class="font-serif text-8xl md:text-9xl mb-8 tracking-tighter text-foxplan-charcoal-brown">Insights</h1>
        <p class="font-aktiv-grotesk text-xl max-w-2xl opacity-80">
            The latest updates on finance and practical tips to help Kiwis make smarter financial decisions.
        </p>
    </section>

    {# 3. TABS WRAPPER #}
    <div x-data="{ activeTab: '{{ firstCategorySlug }}' }" class="relative w-full">

        {% set tabList = [] %}
        {% for cat in dynamicCategories %}
            {% set tabList = tabList | merge([{ id: cat.slug, label: cat.title }]) %}
        {% endfor %}

        {% if tabList is not empty %}
            {% include '_components/ui/tabs/tabs-services.twig' with {
                props: {
                    tabs: tabList,
                    navBg: 'bg-foxplan-yellow',
                    activeBg: 'bg-foxplan-neutral-beige',
                    activeText: 'text-foxplan-charcoal-brown',
                    inactiveText: 'text-foxplan-charcoal-brown/60',
                }
            } only %}
        {% endif %}

        {# 4. CONTENT AREA #}
        <div class="w-full bg-foxplan-neutral-beige pt-20 pb-0 min-h-screen">

            <div class="px-4 md:px-8 lg:px-12 mb-20">
                {% for category in dynamicCategories %}
                    <div x-show="activeTab === '{{ category.slug }}'" x-cloak x-transition>

                        {# Fetch articles specifically for this category and section #}
                        {% set articles = craft.entries()
                            .section('article')
                            .relatedTo(category)
                            .with(['heroImage'])
                            .all()
                        %}

                        {# Pass the imported articles to the grid #}
                        {% include '_sections/content-sections/masonry-grid.twig' with {
                            articles: articles,
                            categoryLabel: category.title
                        } only %}
                    </div>
                {% endfor %}
            </div>

            {# 5. NEWSLETTER SECTIONS #}
            <div class="px-4">
                {% include '_sections/newsletter/newsletter-signup.twig' %}
            </div>

            {% include '_sections/newsletter/Subscribe-newsletter.twig' %}
        </div>
    </div>

    {# 6. FOOTER #}
    {{ include('_components/footer/footer-High-fidelity.twig', {
        props: {
            backgroundColor: 'bg-foxplan-neutral-beige',
            textColor: 'text-foxplan-charcoal-brown',
            logoColor: 'text-foxplan-charcoal-brown',
            buttonColor: 'bg-foxplan-charcoal-brown',
            buttonTextColor: 'text-foxplan-white',
            foxplanText: 'foxplan',
            borderTopColor: 'border-foxplan-yellow/20',
            borderTopWidth: 'border-t-2'
        }
    }) }}

{% endblock %}