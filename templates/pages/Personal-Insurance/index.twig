{% extends "_boilerplate/_layouts/layout-base.twig" %}

{% set navigationTheme = {
    backgroundColor: 'bg-foxplan-neutral-beige',
    textColor: 'text-black',
    actionBgColor: 'bg-foxplan-charcoal-brown'
} %}
{% block blockAppBody %}
{# Static 30 Years of Financial Expertise Section #}
<section class="w-full bg-foxplan-neutral-beige pt-24 pb-24 md:pt-32 md:pb-32 overflow-hidden">
    <div class="container mx-auto px-8">
        <div class="w-full flex flex-col items-center justify-center text-center">

            {#
            The 'leading-[0.85]' and 'tracking-tighter' classes are crucial
            to achieving the editorial, high-end look of the large serif text.
            #}
            <h2 class="font-serif text-5xl md:text-[6.5rem] lg:text-[7.5rem] font-light leading-[0.85] tracking-tighter text-foxplan-charcoal-brown max-w-6xl mx-auto">
                30 Years of<br>Financial Expertise
            </h2>

        </div>
    </div>
</section>

    {# Static Timeline Section with Draggable Growing Arrow #}

    {# 1. Dependencies #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <div x-data="{
    steps: ['1996', '2000', '2007', '2010s', '2012–2017', '2019', '2020s'],
    activeIndex: 0,

    init() {
        gsap.registerPlugin(ScrollTrigger);
        const cards = gsap.utils.toArray('.milestone-card-wrapper');
        const totalSteps = this.steps.length;

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: this.$refs.mainSection,
                start: 'top top',
                end: '+=800%',
                pin: true,
                scrub: 0.5,
                onUpdate: (self) => {
                    this.activeIndex = Math.round(self.progress * (totalSteps - 1));
                }
            }
        });

        // HIDDEN START STATE:
        // Initial opacity set to 0 so no letters are visible.
        // y: 100% moves them entirely out of the frame.
        gsap.set(cards.slice(1), {
            yPercent: 100,
            opacity: 0,
            scale: 0.95
        });

        cards.forEach((card, i) => {
            if (i > 0) {
                tl.to(card, {
                    yPercent: 0,
                    opacity: 1,
                    scale: 1,
                    ease: 'power2.out'
                }, i - 1);
            }
        });
    },
    get arrowPosition() {
        const totalSteps = this.steps.length;
        const columnWidth = 100 / totalSteps;
        const centerOfFirst = columnWidth / 2;
        const centerOfLast = 100 - (columnWidth / 2);
        const availableRange = centerOfLast - centerOfFirst;
        return centerOfFirst + (this.activeIndex * (availableRange / (totalSteps - 1)));
    }
}"
         x-ref="mainSection"
         class="w-full bg-foxplan-neutral-beige h-screen flex flex-col justify-center px-5 overflow-hidden">

        {# --- TIMELINE TRACK --- #}
        <section class="w-full mb-12 select-none z-[100]">
            <div class="relative w-full mb-10 pt-10">
                <div class="absolute top-1/2 left-0 w-full border-t border-dashed border-foxplan-charcoal-brown opacity-20"></div>

                <div class="absolute top-1/2 -translate-y-1/2 left-0 flex items-center pointer-events-none transition-all duration-500 ease-out"
                     :style="`width: ${arrowPosition}%; min-width: 24px;` ">
                    <div class="flex-grow border-t-2 border-foxplan-charcoal-brown border-dashed h-0"></div>
                    <div class="relative flex-shrink-0 w-20 h-6 overflow-hidden flex items-center justify-end -mr-6">
                        <img src="{{ craft.vite.asset('images/placeholder/Arrow_1.svg') }}"
                             alt="Arrow"
                             class="h-4 w-auto max-w-none px-1"
                             style="filter: brightness(0) saturate(100%) invert(8%) sepia(16%) hue-rotate(305deg) brightness(95%) contrast(96%);">
                    </div>
                </div>
            </div>
            <div class="flex justify-between w-full font-serif text-3xl text-foxplan-charcoal-brown">
                <template x-for="(year, index) in steps">
                    <div class="flex-1 flex justify-center items-center">
                    <span :class="activeIndex === index ? 'opacity-100 font-bold' : 'opacity-40'"
                          class="transition-all duration-300"
                          x-text="year"></span>
                    </div>
                </template>
            </div>
        </section>

        {# --- CARD AREA --- #}
        <div class="relative w-full h-[400px] overflow-hidden">

            {% set milestone_data = [
                { year: '1996', title: 'Our Foundations', text: 'FoxPlan was founded by John and Sally Killick and operated out of Investment House on Featherston Street.', bg: 'bg-white' },
                { year: '2000', title: 'A One-Stop Financial Shop', text: 'We evolved into a full-service financial advisory, adding lending, investment, and retirement planning.', bg: 'bg-[#F1C44F]' },
                { year: '2007', title: 'Expanding Our Reach', text: 'Moving to larger premises and expanding our team to meet growing demand in Wellington.', bg: 'bg-white' },
                { year: '2010s', title: 'Digital Innovation', text: 'Modernizing our approach with new technologies while keeping our core personal touch.', bg: 'bg-[#F1C44F]' },
                { year: '2012–2017', title: 'Strategic Growth', text: 'Refining our advisory process and strengthening our partnerships across New Zealand.', bg: 'bg-white' },
                { year: '2019', title: 'New Leadership', text: 'A fresh chapter beginning with updated strategies for a changing financial landscape.', bg: 'bg-[#F1C44F]' },
                { year: '2020s', title: 'The Future of Advice', text: 'Continuing our legacy of helping clients protect and grow what matters most.', bg: 'bg-white' }
            ] %}

            {% for card in milestone_data %}
                <div class="milestone-card-wrapper absolute inset-0 z-[{{ loop.index * 10 }}]">
                    {% include '_components/ui/card/card.twig' with {
                        props: {
                            year: card.year,
                            title: card.title,
                            text: card.text,
                            cardBg: card.bg,
                            textColor: card.bg == 'bg-white' ? 'text-[#270E15]' : 'text-black',
                            accentColor: card.bg == 'bg-white' ? 'text-[#270E15]' : 'text-black',
                            squareColor: card.bg == 'bg-white' ? 'bg-[#270E15]' : 'bg-black',
                            titleColor: card.bg == 'bg-white' ? 'text-[#270E15]' : 'text-black'
                        }
                    } only %}
                </div>
            {% endfor %}
        </div>
    </div>
{#    _components/ui/card/card.twig#}

    {# footer #}

    {{ include('_components/footer/footer-High-fidelity.twig', {
        props: {
            backgroundColor: 'bg-foxplan-charcoal-brown',
            textColor: 'text-foxplan-yellow',
            logoColor: 'text-foxplan-yellow',
            buttonColor: 'bg-foxplan-yellow',
            buttonTextColor: 'text-foxplan-charcoal-brown',
            foxplanText: 'foxplan',
            borderTopColor: 'border-foxplan-yellow/20',
            borderTopWidth: 'border-t-2'
        }
    }) }}
{% endblock %}