{# templates/_sections/content-sections/how-we-work.twig #}

{% set defaults = {
    mainHeading: entry.paragraphHeading2 ?? 'How we work with you',
    mainBody: entry.bodyText4 ?? '',
    accordionField: entry.accordionNew ?? null,
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown'
} %}

{% set data = defaults | merge(props ?? {}) %}

<section class="w-full relative z-20 {{ data.backgroundColor }} py-8 md:py-16 lg:py-24 overflow-hidden">
    <div class="grid grid-cols-1 md:grid-cols-10 w-full items-start">

        {# --- Left Side (30% Gutter) --- #}
        <div class="hidden md:block md:col-span-3"></div>

        {# --- Right Side (70% Content) --- #}
        <div class="col-span-1 md:col-span-7 px-4 md:px-6 lg:px-8 lg:pr-32">

            {# --- Intro Text above the accordion --- #}
            <div class="max-w-5xl mb-12">
                <h2 class="font-serif tracking-tight {{ data.textColor }} mb-10 break-normal"
                    style="font-size: clamp(2.5rem, 6vw + 1rem, 6.5rem); line-height: 0.85; word-break: keep-all;">
                    {{ data.mainHeading | raw }}
                </h2>

                {#
                BODY TEXT:
                #}
                <div class="font-aktiv leading-relaxed {{ data.textColor }} font-medium max-w-2xl opacity-90"
                     style="font-size: clamp(1.125rem, 1vw + 0.5rem, 1.5rem);">
                    {{ (data.mainBody is not empty ? data.mainBody : '') | raw }}
                </div>
            </div>

            {# --- The Accordion --- #}
            <div class="w-full">
                {% set formattedItems = [] %}

                {% if data.accordionField and data.accordionField.exists() %}
                    {% for item in data.accordionField.all() %}
                        {% set formattedItems = formattedItems | merge([{
                            expandableHeadingTitle: item.accordionHeading ?? 'General Information',
                            ExpandableBodyText: item.accordionBodyText ?? ''
                        }]) %}
                    {% endfor %}
                {% endif %}

                {% if formattedItems is empty %}
                    {% set formattedItems = [
                        { expandableHeadingTitle: 'Step 1: Discovery', ExpandableBodyText: 'We start by understanding your unique financial situation.' },
                        { expandableHeadingTitle: 'Step 2: Strategy', ExpandableBodyText: 'We develop a tailored plan to meet your specific goals.' },
                        { expandableHeadingTitle: 'Step 3: Implementation', ExpandableBodyText: 'We put your plan into action with constant support.' }
                    ] %}
                {% endif %}

                {#
                ACCORDION TYPOGRAPHY:
                #}
                {% include '_components/ui/accordion/accordion.twig' with {
                    props: {
                        items: formattedItems,
                        defaultOpen: 0,
                        titleFont: 'font-serif',
                        titleSize: 'text-[1.5rem] md:text-[2.2rem]',
                        titleWeight: 'font-light',
                        textColor: data.textColor,
                        backgroundColor: 'bg-foxplan-white',
                        classes: 'w-full'
                    }
                } only %}
            </div>
        </div>
    </div>
</section>