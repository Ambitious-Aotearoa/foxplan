{# templates/_sections/content-sections/episode-list.twig #}

{# 1. FETCH DATA: We specifically target the 'podcasts' type to stop duplicates from appearing #}
{% set episodes = craft.entries.section('podcastEpisodes').type('podcasts').limit(6).all() %}

<div class="w-full {{ data.backgroundColor ?? 'bg-[#F4F1E6]' }} p-[20px]">
    <section class="w-full overflow-hidden">
        <div class="px-8 md:px-12 w-full pt-16 pb-16 md:pt-24 md:pb-24">

            <div class="divide-y divide-[#E8BD5B]">
                {% for episode in episodes %}
                    <div class="flex flex-col md:flex-row md:items-center justify-between py-10 px-4 -mx-4 group transition-all duration-300 hover:bg-[#2D1B17]">
                        <div class="flex items-start md:items-center pr-8 mb-6 md:mb-0">

                            {# Thumbnail #}
                            <div class="w-40 h-24 mr-8 flex-shrink-0 overflow-hidden bg-[#D1CDBB]">
                                <img src="/assets/images/Podcast_1.jpg"
                                     alt="{{ episode.title }}"
                                     class="w-full h-full object-cover block grayscale group-hover:grayscale-0 transition-all duration-500">
                            </div>

                            {# Episode Info #}
                            <div>
                                <h3 class="font-serif text-2xl md:text-[32px] leading-tight {{ data.textColor ?? 'text-[#2D1B17]' }} mb-2 group-hover:text-[#E8BD5B] transition-colors">
                                    {{ episode.mainHeading ?? episode.title }}
                                </h3>

                                <div class="flex items-center gap-4">
                                    <p class="text-sm text-gray-500 font-sans uppercase tracking-wider group-hover:text-white/60">
                                        {{ episode.postDate | date('M d, Y') }}
                                    </p>

                                    {# DURATION FIX: Handles raw seconds (2682) or timestamps (00:45:00) #}
                                    {% if episode.episodeDuration %}
                                        <span class="text-gray-400">•</span>
                                        <p class="text-sm text-gray-500 font-sans uppercase tracking-wider group-hover:text-white/60">
                                            {% if ':' in episode.episodeDuration %}
                                                {# It is HH:MM:SS format #}
                                                {% set parts = episode.episodeDuration | split(':') %}
                                                {% if parts | length == 3 %}
                                                    {{ (parts[0] * 60) + parts[1] }} MINUTES
                                                {% else %}
                                                    {{ parts[0] }} MINUTES
                                                {% endif %}
                                            {% else %}
                                                {# It is raw seconds (e.g. 2682), so we divide by 60 #}
                                                {{ (episode.episodeDuration / 60) | round(0, 'floor') }} MINUTES
                                            {% endif %}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {# Listen Button #}
                        <div class="flex-shrink-0">
                            {% set listenUrl = (episode.spotifyUrl | trim) ?: episode.url %}
                            <a href="{{ listenUrl }}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="inline-block px-10 py-3 bg-black text-white font-bold uppercase text-[10px] tracking-[0.2em] group-hover:bg-[#E8BD5B] group-hover:text-black transition-all">
                                Listen ↗
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
</div>