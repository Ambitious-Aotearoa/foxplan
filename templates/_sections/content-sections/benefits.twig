{# templates/_sections/content-sections/benefits.twig #}
{% set data = {
    paragraphHeading: null,
    bodyText: null,
    items: [],
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown'
} | merge(props ?? {}) %}

{% set textBaseColor = data.textColor | replace('text-', '') %}

<section class="w-full {{ data.backgroundColor }} py-20 overflow-hidden relative"
         x-data="{
            yPos: 0,
            handleScroll() {
                let container = this.$refs.sectionWrapper;
                let lineContainer = this.$refs.lineContainer;
                let rect = container.getBoundingClientRect();

                if (lineContainer) {
                    let lineRect = lineContainer.getBoundingClientRect();
                    let scrollProgress = (window.innerHeight / 2) - rect.top;
                    let percentage = Math.max(0, Math.min(scrollProgress / rect.height, 1));
                    this.yPos = percentage * lineRect.height;
                }
            }
         }"
         x-init="handleScroll()"
         @scroll.window="handleScroll()"
         x-ref="sectionWrapper">

    <div class="grid grid-cols-1 md:grid-cols-10 w-full items-start relative">

        {# --- LEFT SIDE: HEADING --- #}
        <div class="md:col-span-3 px-4 md:px-6 lg:px-8 md:pl-12 lg:pl-16 mb-12 md:mb-0">
            <h2 class="font-serif tracking-tight {{ data.textColor }} break-normal"
                style="font-size: clamp(2.25rem, 4vw + 1rem, 4.5rem); line-height: 0.85; word-break: keep-all;">
                {{ data.paragraphHeading | raw }}
            </h2>

            {% if data.bodyText and data.bodyText|trim is not empty %}
                {# Reduced leading to 1.4 for a tighter paragraph block #}
                <div class="font-aktiv opacity-90 max-w-xs mt-6 {{ data.textColor }} font-medium"
                     style="font-size: clamp(0.9rem, 0.4vw + 0.8rem, 1.1rem); line-height: 1.4;">
                    {{ data.bodyText | raw }}
                </div>
            {% endif %}
        </div>

        {# --- INTERACTIVE SCROLL LINE --- #}
        <div class="hidden md:flex absolute left-[30%] top-0 bottom-0 w-8 justify-center z-30"
             x-ref="lineContainer">
            <div class="h-full w-px border-l border-dashed border-{{ textBaseColor }} opacity-20"></div>
            <div class="absolute top-0 w-px border-l-2 border-solid border-{{ textBaseColor }} transition-all duration-75 ease-out"
                 :style="'height: ' + yPos + 'px'"></div>
            <div class="absolute w-4 h-4 bg-{{ textBaseColor }} rounded-full shadow-md -translate-x-[0.5px] transition-all duration-75 ease-out"
                 :style="'transform: translateY(' + yPos + 'px)'"></div>
        </div>

        {# --- RIGHT SIDE (The Cards) --- #}
        <div class="col-span-1 md:col-span-7 px-4 md:px-6 lg:px-8 md:pl-20 pr-[20px]">
            <div class="flex flex-col space-y-6">
                {% for item in data.items %}
                    <div class="benefit-card group w-full transition-all duration-300 rounded-none cursor-pointer select-none outline-none"
                         x-data="{
                            isScrollActive: false,
                            isMobileHover: false,
                            checkActive() {
                                if (window.innerWidth >= 768) {
                                    let rect = $el.getBoundingClientRect();
                                    let lineRect = $refs.lineContainer.getBoundingClientRect();
                                    let circleGlobalY = lineRect.top + yPos;
                                    this.isScrollActive = (circleGlobalY >= rect.top && circleGlobalY <= rect.bottom);
                                }
                            }
                         }"
                         x-init="$watch('yPos', () => checkActive())"
                         @touchstart="if(window.innerWidth < 768) isMobileHover = true"
                         @touchend="isMobileHover = false"
                         @touchcancel="isMobileHover = false"
                         :class="(isScrollActive || isMobileHover) ? 'bg-foxplan-white p-8 md:p-10 md:translate-x-4 shadow-lg' : 'bg-transparent p-8 md:p-10 md:translate-x-0 shadow-none'">

                        {% if item.title %}
                            <h4 class="font-aktiv text-[10px] font-bold tracking-[0.2em] uppercase mb-3 transition-all duration-500"
                                :class="(isScrollActive || isMobileHover) ? 'text-foxplan-charcoal-brown opacity-100' : '{{ data.textColor }} opacity-40'">
                                {{ item.title }}
                            </h4>
                        {% endif %}

                        {% if item.text %}
                            <div class="font-serif transition-all duration-500 w-full break-normal"
                                 style="font-size: clamp(1.35rem, 2vw + 1rem, 2rem); line-height: 1.2; word-break: keep-all;"
                                 :class="(isScrollActive || isMobileHover) ? 'text-foxplan-charcoal-brown opacity-100' : '{{ data.textColor }} opacity-60'">
                                {{ item.text | raw }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>