{# templates/_sections/content-sections/benefits.twig #}
{% set data = {
    paragraphHeading: null,
    bodyText: null,
    items: [],
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown'
} | merge(props ?? {}) %}

<section class="w-full {{ data.backgroundColor }} py-24 overflow-hidden relative"
         x-data="{
            yPos: 0,
            isDragging: false,
            {# This function sets the circle to the center of the first item on load #}
            initCircle() {
                this.$nextTick(() => {
                    let firstItem = this.$refs.accordionContainer.firstElementChild;
                    if (firstItem) {
                        let containerRect = this.$refs.lineContainer.getBoundingClientRect();
                        let itemRect = firstItem.getBoundingClientRect();
                        {# Calculate the center point of the first box relative to the line container #}
                        this.yPos = (itemRect.top + (itemRect.height / 2)) - containerRect.top;
                    }
                });
            },
            handleMove(e) {
                if (!this.isDragging) return;
                let container = this.$refs.lineContainer.getBoundingClientRect();
                let clientY = e.touches ? e.touches[0].clientY : e.clientY;
                let relativeY = clientY - container.top;
                this.yPos = Math.max(0, Math.min(relativeY, container.height));
            }
         }"
         x-init="initCircle()"
         @mousemove.window="handleMove"
         @mouseup.window="isDragging = false"
         @touchmove.window.passive="handleMove"
         @touchend.window="isDragging = false">

    <div class="grid grid-cols-1 md:grid-cols-10 w-full items-start relative">

        {# --- LEFT SIDE (30%) --- #}
        <div class="col-span-1 md:col-span-3 px-8 md:pl-12 lg:pl-16 z-20">
            <h2 class="font-serif text-5xl md:text-6xl lg:text-[5rem] leading-[0.85] tracking-tighter mb-6 {{ data.textColor }}">
                {{ data.paragraphHeading | raw }}
            </h2>
            {% if data.bodyText %}
                <div class="font-aktiv text-base opacity-80 max-w-xs {{ data.textColor }}">
                    {{ data.bodyText | raw }}
                </div>
            {% endif %}
        </div>

        {# --- INTERACTIVE LINE (At the 30% border) --- #}
        <div class="hidden md:flex absolute left-[30%] top-0 bottom-0 w-8 justify-center touch-none z-30"
             x-ref="lineContainer">
            <div class="h-full w-px border-l border-dashed border-[#270E15] opacity-20"></div>
            <div class="absolute top-0 w-px border-l-2 border-dashed border-[#270E15] opacity-100"
                 :style="`height: ${yPos}px`"
                 style="transition: height 0.05s linear;"></div>
            <div class="absolute w-6 h-6 bg-[#270E15] rounded-full cursor-grab active:cursor-grabbing shadow-md"
                 :style="`transform: translateY(${yPos}px)`"
                 @mousedown="isDragging = true"
                 @touchstart.prevent="isDragging = true">
            </div>
        </div>

        {# --- RIGHT SIDE (70%) --- #}
        <div class="col-span-1 md:col-span-7 px-8 md:pl-20 lg:pr-32">
            {# We add x-ref='accordionContainer' here to help Alpine find the items #}
            <div class="flex flex-col space-y-4" x-ref="accordionContainer">
                {% for item in data.items %}
                    <div class="group w-full p-10 transition-all duration-300 rounded-xl"
                         x-data="{
                            isActive() {
                                let rect = $el.getBoundingClientRect();
                                let lineRect = $refs.lineContainer.getBoundingClientRect();
                                let circleY = lineRect.top + yPos;
                                return circleY >= rect.top && circleY <= rect.bottom;
                            }
                         }"
                         :class="isActive() ? 'bg-white shadow-xl translate-x-2' : 'bg-transparent'">

                        {% if item.title %}
                            <h4 class="font-aktiv text-[10px] md:text-xs font-bold tracking-[0.2em] uppercase mb-4 text-[#1a0a0e] transition-opacity"
                                :class="isActive() ? 'opacity-100' : 'opacity-40'">
                                {{ item.title }}
                            </h4>
                        {% endif %}

                        {% if item.text %}
                            <div class="font-aktiv text-lg md:text-2xl lg:text-[1.8rem] leading-snug {{ data.textColor }} transition-opacity"
                                 :class="isActive() ? 'opacity-100' : 'opacity-60'">
                                {{ item.text | raw }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>