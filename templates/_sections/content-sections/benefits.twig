{# templates/_sections/content-sections/benefits.twig #}
{% set data = {
    paragraphHeading: null,
    bodyText: null,
    items: [],
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown'
} | merge(props ?? {}) %}

{% set textBaseColor = data.textColor | replace('text-', '') %}

<section class="w-full {{ data.backgroundColor }} py-24 overflow-hidden relative"
         x-data="{
            yPos: 0,
            handleScroll() {
                let container = this.$refs.sectionWrapper;
                let lineContainer = this.$refs.lineContainer;
                let rect = container.getBoundingClientRect();
                let lineRect = lineContainer.getBoundingClientRect();

                let scrollProgress = (window.innerHeight / 2) - rect.top;
                let percentage = Math.max(0, Math.min(scrollProgress / rect.height, 1));

                this.yPos = percentage * lineRect.height;
            }
         }"
         x-init="handleScroll()"
         @scroll.window="handleScroll()"
         x-ref="sectionWrapper">

    <div class="grid grid-cols-1 md:grid-cols-10 w-full items-start relative">

        {# --- LEFT SIDE --- #}
        <div class="col-span-1 md:col-span-3 px-8 md:pl-12 lg:pl-16 mt-6">
            <h2 class="font-serif text-5xl md:text-6xl lg:text-[5rem] leading-[0.85] tracking-tighter {{ data.textColor }}">
                {{ data.paragraphHeading | raw }}
            </h2>

            {% if data.bodyText and data.bodyText|trim is not empty %}
                <div class="font-aktiv text-base opacity-80 max-w-xs mt-6 {{ data.textColor }}">
                    {{ data.bodyText | raw }}
                </div>
            {% endif %}
        </div>

        {# --- INTERACTIVE SCROLL LINE --- #}
        <div class="hidden md:flex absolute left-[30%] top-0 bottom-0 w-8 justify-center z-30"
             x-ref="lineContainer">
            <div class="h-full w-px border-l border-dashed border-{{ textBaseColor }} opacity-20"></div>

            <div class="absolute top-0 w-px border-l-2 border-solid border-{{ textBaseColor }} transition-all duration-75 ease-out"
                 :style="'height: ' + yPos + 'px'"
                 style="will-change: height;"></div>

            <div class="absolute w-4 h-4 bg-{{ textBaseColor }} rounded-full shadow-md -translate-x-[0.5px] transition-all duration-75 ease-out"
                 :style="'transform: translateY(' + yPos + 'px)'"
                 style="will-change: transform;">
            </div>
        </div>

        {# --- RIGHT SIDE (The Cards) --- #}
        <div class="col-span-1 md:col-span-7 px-8 md:pl-20 pr-[20px]">
            <div class="flex flex-col space-y-8" x-ref="accordionContainer">
                {% for item in data.items %}
                    <div class="group w-full transition-all duration-500 rounded-none"
                         x-data="{
                            isActive: false,
                            checkActive() {
                                let rect = $el.getBoundingClientRect();
                                let lineRect = $refs.lineContainer.getBoundingClientRect();
                                let circleGlobalY = lineRect.top + yPos;

                                this.isActive = (circleGlobalY >= rect.top && circleGlobalY <= rect.bottom);
                            }
                         }"
                         x-init="$watch('yPos', () => checkActive())"
                            {# REMOVED: shadow-2xl from the line below #}
                         :class="isActive ? 'bg-white p-12 translate-x-4' : 'bg-transparent p-12 translate-x-0'">

                        {% if item.title %}
                            <h4 class="font-aktiv text-[10px] md:text-xs font-bold tracking-[0.2em] uppercase mb-4 transition-all duration-500"
                                :class="isActive ? 'text-foxplan-charcoal-brown opacity-100' : '{{ data.textColor }} opacity-40'">
                                {{ item.title }}
                            </h4>
                        {% endif %}

                        {% if item.text %}
                            <div class="font-aktiv text-lg md:text-2xl lg:text-[1.8rem] leading-relaxed transition-all duration-500 w-full"
                                 :class="isActive ? 'text-foxplan-charcoal-brown opacity-100' : '{{ data.textColor }} opacity-60'">
                                {{ item.text | raw }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>