{# 1. FETCH ASSETS FROM CRAFT #}
{% set section1Image = entry.image.one() %}
{% set section2Image = entry.image2.one() %}

{# Static Fallbacks using direct disk paths for Staging stability #}
{% set fallback1 = alias('@web/dist/images/About_1.jpg') %}
{% set fallback2 = alias('@web/dist/images/About_2.jpg') %}

<section class="w-full relative overflow-hidden" id="scroll-container">

    {# --- THE DOTTED LINE & MOVING DOT --- #}
    <div class="hidden md:block absolute left-1/2 -translate-x-1/2 top-0 bottom-0 w-[2px] z-50 pointer-events-none">
        <div class="h-full w-full border-l-2 border-dashed border-foxplan-charcoal-brown/10"></div>

        <div id="progress-line"
             class="absolute top-0 left-0 w-full border-l-2 border-dashed border-foxplan-charcoal-brown transition-all duration-75 ease-out"
             style="height: 0%;"></div>

        <div id="scrolling-dot"
             class="absolute left-1/2 -translate-x-1/2 top-0 w-3 h-3 bg-foxplan-charcoal-brown rounded-full shadow-sm opacity-0 transition-opacity duration-300"
             style="transform: translate(-50%, -50%);">
        </div>
    </div>

    {# --- SECTION 1: Yellow --- #}
    <div class="bg-foxplan-yellow pt-24 pb-12 relative z-20">
        <div class="grid grid-cols-1 md:grid-cols-10 w-full items-start">
            <div class="col-span-1 md:col-span-6 px-8 md:pl-12 lg:pl-16">
                <div class="max-w-2xl">
                    <h2 class="font-serif text-5xl lg:text-[5rem] leading-[0.9] tracking-tight mb-8 text-foxplan-charcoal-brown">
                        {{ entry.paragraphHeading4 | raw }}
                    </h2>
                    <div class="font-aktiv text-base md:text-lg opacity-80 text-foxplan-charcoal-brown mb-10">
                        {{ entry.bodyText3 | raw }}
                    </div>

                    {% if entry.button2 is not empty %}
                        <a href="{{ entry.buttonLink.url ?? entry.buttonLink }}" class="inline-flex items-center gap-3 bg-foxplan-charcoal-brown text-white px-8 py-3 text-xs uppercase tracking-widest hover:bg-opacity-90 transition-all">
                            {{ entry.button2 }}
                            <svg width="14" height="10" viewBox="0 0 18 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 1L17 6L12 11M1 6H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="col-span-1 md:col-start-7 md:col-span-4">
                <div class="w-full relative -mb-48 md:-mb-72 lg:-mb-96 z-30">
                    <img src="{{ section1Image ? section1Image.url : fallback1 }}"
                         alt="{{ section1Image.title ?? 'About Foxplan' }}"
                         class="w-full h-[650px] lg:h-[900px] object-cover shadow-2xl">
                </div>
            </div>
        </div>
    </div>

    {# --- SECTION 2: White/Beige --- #}
    <div class="bg-white pt-[150px] md:pt-[250px] relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-10 w-full items-end">

            <div class="col-span-1 md:col-span-4 self-end leading-[0]">
                <img src="{{ section2Image ? section2Image.url : fallback2 }}"
                     alt="{{ section2Image.title ?? 'Foxplan Mission' }}"
                     class="w-full h-[700px] lg:h-[950px] object-cover block">
            </div>

            <div class="col-span-1 md:col-start-7 md:col-span-4 px-8 md:pl-0 md:pr-12 lg:pr-24 pb-24 md:pb-40">
                <div>
                    <h2 class="font-serif text-5xl lg:text-[4.5rem] leading-[0.9] text-foxplan-charcoal-brown mb-8">
                        {{ entry.paragraphHeading5 | raw }}
                    </h2>
                    <div class="font-aktiv text-base md:text-lg text-foxplan-charcoal-brown/80 mb-10">
                        {{ entry.bodyText4 | raw }}
                    </div>

                    {% if entry.button3 is not empty %}
                        <a href="{{ entry.buttonLink2.url ?? entry.buttonLink2 }}" class="inline-flex items-center gap-3 bg-foxplan-charcoal-brown text-white px-8 py-3 text-xs uppercase tracking-widest hover:bg-opacity-90 transition-all">
                            {{ entry.button3 }}
                            <svg width="14" height="10" viewBox="0 0 18 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 1L17 6L12 11M1 6H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('scroll-container');
        const dot = document.getElementById('scrolling-dot');
        const progressLine = document.getElementById('progress-line');

        function updateTimeline() {
            if (!container || !dot || !progressLine) return;

            const containerRect = container.getBoundingClientRect();
            const viewHeight = window.innerHeight;
            let scrollProgress = (viewHeight / 2 - containerRect.top) / containerRect.height;

            if (scrollProgress > 0.01 && scrollProgress < 0.99) {
                dot.style.opacity = "1";
            } else {
                dot.style.opacity = "0";
            }

            scrollProgress = Math.max(0, Math.min(1, scrollProgress));
            const percentage = scrollProgress * 100;

            dot.style.top = percentage + '%';
            progressLine.style.height = percentage + '%';
        }

        window.addEventListener('scroll', updateTimeline);
        window.addEventListener('resize', updateTimeline);
        updateTimeline();
    });
</script>