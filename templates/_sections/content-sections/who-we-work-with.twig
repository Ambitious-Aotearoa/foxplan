{# templates/_sections/content-sections/who-we-work-with.twig #}

{# 1. REUSABLE LOGIC #}
{% set data = {
    title:           'WHO WE WORK WITH',
    backgroundColor: 'bg-foxplan-neutral-beige',
    textColor:       'text-foxplan-charcoal-brown',
    borderColor:     'border-foxplan-charcoal-brown/20',
    assetVolume:     'suppliersLogo'
} | merge(props ?? {}) %}

{# 2. FETCH LOGOS #}
{% set displayLogos = craft.assets()
    .volume(data.assetVolume)
    .kind('image')
    .limit(8)
    .all() %}

{% if displayLogos|length > 0 %}
    <section class="w-full {{ data.backgroundColor }}">
        <div class="w-full">
            <div class="pt-10 pb-6 px-8">
                <p class="font-aktiv-grotesk text-[11px] font-bold tracking-[0.2em] uppercase {{ data.textColor }} opacity-80">
                    {{ data.title }}
                </p>
            </div>

            <div class="px-8 pb-16">
                <div class="border {{ data.borderColor }}">
                    <div class="grid grid-cols-2 md:grid-cols-4" id="logo-grid">
                        {% for logo in displayLogos %}
                            <div class="logo-card relative overflow-hidden aspect-[1.6/1] flex items-center justify-center p-4 md:p-8 border-r border-b {{ data.borderColor }}
                            [&:nth-child(2n)]:border-r-0 md:[&:nth-child(2n)]:border-r md:[&:nth-child(4n)]:border-r-0
                            [&:nth-last-child(-n+2)]:border-b-0 md:[&:nth-last-child(-n+4)]:border-b-0">

                                {# The "Frame": This container is the exact same size for every logo #}
                                <div class="logo-wrapper transition-all duration-700 ease-in-out flex items-center justify-center w-[120px] h-[40px] md:w-[160px] md:h-[60px]">
                                    <img src="{{ logo.url }}"
                                         alt="{{ logo.title }}"
                                            {# We use max-h and max-w to ensure they are clear but NEVER too big #}
                                         class="logo-img max-w-full max-h-full w-auto h-auto object-contain">
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wrappers = document.querySelectorAll('.logo-wrapper');
            if (wrappers.length < 2) return;

            function swapLogos() {
                let idxA = Math.floor(Math.random() * wrappers.length);
                let idxB = Math.floor(Math.random() * wrappers.length);
                while (idxA === idxB) {
                    idxB = Math.floor(Math.random() * wrappers.length);
                }

                const wrapperA = wrappers[idxA];
                const wrapperB = wrappers[idxB];
                const imgA = wrapperA.querySelector('img');
                const imgB = wrapperB.querySelector('img');

                if (!imgA || !imgB) return;

                wrapperA.style.opacity = '0';
                wrapperA.style.transform = 'scale(0.95)';
                wrapperB.style.opacity = '0';
                wrapperB.style.transform = 'scale(0.95)';

                setTimeout(() => {
                    const tempSrc = imgA.src;
                    const tempAlt = imgA.alt;
                    imgA.src = imgB.src;
                    imgA.alt = imgB.alt;
                    imgB.src = tempSrc;
                    imgB.alt = tempAlt;

                    wrapperA.style.opacity = '1';
                    wrapperA.style.transform = 'scale(1)';
                    wrapperB.style.opacity = '1';
                    wrapperB.style.transform = 'scale(1)';
                }, 700);
            }
            setInterval(swapLogos, 4000);
        });
    </script>
{% endif %}