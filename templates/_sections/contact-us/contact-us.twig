{# _sections/contact-us/contact-us.twig #}

{% set defaults = {
    backgroundColor: 'bg-white',
    textColor: 'text-gray-900',
    accentColor: 'text-gray-700',
    borderColor: 'border-gray-400',
    content: {
        call: {
            heading: 'Message us',
            description: 'New to FoxPlan? Please tell us which service you\'re interest in and one of our Advisers will be in touch soon. Alternatively, you can request a call back below.',
            phone1: '0800 NO STRESS (0800 667 873)',
            phone2: 'Office: (04) 918 4659',
            form: {
                submitText: 'Submit',
                formAction: '#',
                fields: [
                    { label: 'FIRST NAME', name: 'first_name', placeholder: 'John', type: 'text', colSpan: 6 },
                    { label: 'LAST NAME', name: 'last_name', placeholder: 'Doe', type: 'text', colSpan: 6 },
                    { label: 'I AM INTERESTED IN', name: 'interest', type: 'select', options: ['Insurance', 'Mortgages', 'KiwiSaver'], colSpan: 6 },
                    { label: 'BEST TIME TO CALL', name: 'call_time', type: 'select', options: ['Morning', 'Afternoon', 'Evening'], colSpan: 6 },
                    { label: 'PHONE', name: 'phone', placeholder: '1234 567 890', type: 'tel', colSpan: 6 },
                    { label: 'EMAIL', name: 'email', placeholder: 'johndoe@email.com', type: 'email', colSpan: 6 },
                    { label: 'MESSAGE', name: 'message', placeholder: 'Enter your message', type: 'textarea', colSpan: 12 }
                ]
            }
        },
        callback: {
            heading: 'Request a Callback',
            body1: 'Set up a call with one of our advisers at a time that suits you. If you\'re new to FoxPlan, please let us know which services you are interested in so we can match you with the right adviser.',
            body2: 'If you know who you would like to speak to, you can select their name from the dropdown list.',
            placeholderText: 'Calendly embed'
        },
        location: {
            heading: 'Our Location',
            body: 'Visiting our office? You\'ll find us at Level 8, 138 The Terrace Wellington.',
            placeholderText: 'Map embed'
        }
    }
} %}

{# --- BULLETPROOF DEEP MERGE --- #}
{% set data = defaults | merge(props | default({})) %}

{# Manually merge sub-objects to prevent Twig from deleting keys #}
{% set callContent = defaults.content.call %}
{% if props.content.call is defined %}
    {% set callContent = defaults.content.call | merge(props.content.call) %}
{% endif %}

{% set callbackContent = defaults.content.callback %}
{% if props.content.callback is defined %}
    {% set callbackContent = defaults.content.callback | merge(props.content.callback) %}
{% endif %}

{% set locationContent = defaults.content.location %}
{% if props.content.location is defined %}
    {% set locationContent = defaults.content.location | merge(props.content.location) %}
{% endif %}

{# Re-assemble the content object #}
{% set finalContent = {
    call: callContent,
    callback: callbackContent,
    location: locationContent
} %}
{% set data = data | merge({ content: finalContent }) %}

{# --- STYLING --- #}
{% set descriptionClasses = 'text-base leading-relaxed mb-6 ' ~ data.accentColor %}
{% set phoneClasses = 'text-base font-semibold block mb-1 ' ~ data.textColor %}
{% set labelClasses = 'text-sm font-semibold uppercase tracking-wider mb-2 block ' ~ data.textColor %}
{% set inputClasses = 'w-full py-2 border-b focus:outline-none bg-transparent placeholder-gray-500 ' ~ data.textColor ~ ' ' ~ data.borderColor ~ ' focus:border-current' %}
{% set tabTitleClasses = 'font-serif text-4xl sm:text-5xl lg:text-[4rem] font-light leading-none mb-6 ' ~ data.textColor %}

{# --- MACROS --- #}
{% macro render_call_tab_content(data, descriptionClasses, phoneClasses, labelClasses, inputClasses) %}
    <div class="grid grid-cols-1 md:grid-cols-12 gap-x-12">
        <div class="md:col-span-5 mb-12 md:mb-0">
            <p class="{{ descriptionClasses }} max-w-md">{{ data.description }}</p>
            <div class="pt-4">
                <span class="{{ labelClasses }} opacity-60">PHONE</span>
                <span class="{{ phoneClasses }} font-normal">{{ data.phone1 }}</span>
                <span class="{{ phoneClasses }} font-normal">{{ data.phone2 }}</span>
            </div>
        </div>
        <div class="md:col-span-7">
            <form action="{{ data.form.formAction }}" method="POST">
                <div class="grid grid-cols-12 gap-x-8 gap-y-12">
                    {% for field in data.form.fields %}
                        <div class="col-span-{{ field.colSpan }}">
                            <label class="{{ labelClasses }}">{{ field.label }}</label>
                            {% if field.type == 'select' %}
                                <div class="relative">
                                    <select class="{{ inputClasses }} appearance-none pr-8">
                                        {% for option in field.options %}<option value="{{ option }}">{{ option }}</option>{% endfor %}
                                    </select>
                                </div>
                            {% elseif field.type == 'textarea' %}
                                <textarea rows="4" class="{{ inputClasses }} resize-none"></textarea>
                            {% else %}
                                <input type="{{ field.type }}" placeholder="{{ field.placeholder }}" class="{{ inputClasses }}">
                            {% endif %}
                        </div>
                    {% endfor %}
                    <div class="col-span-12 mt-4">
                        <button type="submit" class="bg-black text-white py-4 px-10 text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-colors">
                            {{ data.form.submitText }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endmacro %}

{% import _self as macros %}

{# --- TABS CONFIG --- #}
{% set tabsComponentData = {
    defaultTab: 'call',
    backgroundColor: data.backgroundColor,
    textColor: data.textColor,
    titleClasses: tabTitleClasses,
    tabs: [
        {
            id: 'call',
            label: 'Call FoxPlan',
            title: data.content.call.heading,
            content: macros.render_call_tab_content(data.content.call, descriptionClasses, phoneClasses, labelClasses, inputClasses),
        },
        {
            id: 'callback',
            label: 'Request a Callback',
            title: data.content.callback.heading,
            content: '
                <div class="grid md:grid-cols-2 gap-12">
                    <div>
                        <p class="'~descriptionClasses~'">'~data.content.callback.body1~'</p>
                        <p class="'~descriptionClasses~'">'~data.content.callback.body2~'</p>
                    </div>
                    <div class="h-[450px] bg-gray-100 flex items-center justify-center text-gray-400">
                        '~data.content.callback.placeholderText~'
                    </div>
                </div>'
        },
        {
            id: 'location',
            label: 'Our Location',
            title: data.content.location.heading,
            content: '
                <div class="grid md:grid-cols-2 gap-12">
                    <div>
                        <p class="'~descriptionClasses~'">'~data.content.location.body~'</p>
                    </div>
                    <div class="h-[450px] bg-gray-100 flex items-center justify-center text-gray-400">
                        '~data.content.location.placeholderText~'
                    </div>
                </div>'
        }
    ]
} %}

{# --- RENDER --- #}
<section class="w-full {{ data.backgroundColor }} py-16 md:py-24">
    <div class="mx-auto px-4">
        {% include '_components/ui/tabs/tabs.twig' with {
            data: tabsComponentData
        } %}
    </div>
</section>