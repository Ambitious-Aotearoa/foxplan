{#
Our Services Slider Section
- Framing: Exactly 3 cards visible on desktop landing
- Permanent Gutters: 20px via parent wrapper for perfect alignment
- Dynamic Links: Supports "Text | /url" format in subLinks field
#}

{% set defaults = {
    backgroundColor: 'bg-foxplan-yellow',
    heading: entry.paragraphHeading2 ?? 'Our Services',
    introText: entry.bodyText2 ?? '',
    textColor: 'text-foxplan-charcoal-brown'
} %}

{% set data = defaults | merge(props ?? {}) %}

<section class="w-full pt-10 md:pt-20 lg:pt-32 pb-0 {{ data.backgroundColor }} overflow-hidden">

    {# 1. HEADER SECTION #}
    <div class="w-full px-[20px] mb-4 lg:mb-12">
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start gap-8">
            <h2 class="font-serif text-5xl lg:text-8xl {{ data.textColor }}">
                {{ data.heading | raw }}
            </h2>
            {% if data.introText %}
                <div class="max-w-md font-aktiv text-lg {{ data.textColor }}">
                    {{ data.introText | raw }}
                </div>
            {% endif %}
        </div>
    </div>

    {# 2. DRAGGABLE SLIDER AREA #}
    <div class="relative px-[20px] mt-10 lg:mt-16"
         x-data="{
            isDown: false, startX: 0, scrollLeft: 0,
            mousedown(e) {
                this.isDown = true;
                this.startX = e.pageX - $refs.slider.offsetLeft;
                this.scrollLeft = $refs.slider.scrollLeft;
            },
            mouseleave() { this.isDown = false; },
            mouseup() { this.isDown = false; },
            mousemove(e) {
                if (!this.isDown) return;
                e.preventDefault();
                const x = e.pageX - $refs.slider.offsetLeft;
                const walk = (x - this.startX) * 2;
                $refs.slider.scrollLeft = this.scrollLeft - walk;
            }
         }">

        <div x-ref="slider"
             @mousedown="mousedown" @mouseleave="mouseleave" @mouseup="mouseup" @mousemove="mousemove"
             class="flex gap-[8px] overflow-x-auto scrollbar-hide cursor-grab active:cursor-grabbing select-none pb-0 snap-x snap-mandatory"
             style="-ms-overflow-style: none; scrollbar-width: none; scroll-behavior: smooth;">

            {% if entry.services is defined %}
                {% for block in entry.services.all() %}
                    <div class="flex-shrink-0 snap-start bg-foxplan-neutral-beige px-4 lg:px-12 flex flex-col lg:min-h-[700px] min-h-[500px]
                                w-[85vw] md:w-[45vw] lg:w-[calc((100%/3)-6px)]">

                        <div class="mt-[50px] lg:mt-[100px] flex-grow">
                            <h3 class="font-serif text-4xl lg:text-5xl mb-8 {{ data.textColor }}">
                                {{ block.mainHeading | raw }}
                            </h3>

                            <div class="font-aktiv text-lg mb-10 {{ data.textColor }} opacity-90 leading-snug">
                                {{ block.bodyText | raw }}
                            </div>

                            {% if block.button is not empty %}
                                <div class="mb-12">
                                    <a href="#" class="inline-flex items-center gap-3 bg-foxplan-charcoal-brown text-foxplan-neutral-beige px-8 py-3 text-[10px] uppercase tracking-[0.2em] font-bold group">
                                        {{ block.button.text ?? block.button }}
                                        <svg width="18" height="12" viewBox="0 0 18 12" fill="none" class="transition-transform group-hover:translate-x-1">
                                            <path d="M12 1L17 6L12 11M1 6H16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>
                            {% endif %}

                            {# --- DYNAMIC SUB-LINKS --- #}
                            {% if block.subLinks is defined and block.subLinks is not empty %}
                                <ul class="space-y-4 mb-4">
                                    {% set linkLines = block.subLinks | split('\n') %}
                                    {% for line in linkLines %}
                                        {% if line | trim is not empty %}
                                            {% set parts = line | split('|') %}
                                            {% set linkText = parts[0] | trim %}
                                            {% set linkUrl = parts[1] is defined ? parts[1] | trim : '#' %}
                                            <li>
                                                <a href="{{ linkUrl }}" class="font-aktiv text-lg lg:text-xl {{ data.textColor }} hover:underline block opacity-80 hover:opacity-100 transition-all">
                                                    {{ linkText }}
                                                </a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="min-w-[20px] flex-shrink-0"></div>
        </div>
    </div>
</section>