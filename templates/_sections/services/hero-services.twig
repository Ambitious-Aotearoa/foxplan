{#
Our Services Slider Section
- Typography: strictly using Season Serif and Aktiv Grotesk
- Component Integration: Using the standard button component
- Mobile Preview: Enlarged cards (90vw width / 600px min-height)
#}

{% set defaults = {
    backgroundColor: 'bg-foxplan-yellow',
    heading: entry.paragraphHeading2 ?? 'Our Services',
    introText: entry.bodyText2 ?? '',
    textColor: 'text-foxplan-charcoal-brown',
} %}

{% set data = defaults | merge(props ?? {}) %}

<section class="w-full h-screen flex flex-col pt-16 pb-0 {{ data.backgroundColor }} overflow-hidden" id="services-horizontal-section">

    {# 1. HEADER SECTION #}
    <div class="w-full px-[20px] flex-shrink-0">
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start gap-8">
            <h2 class="font-serif {{ data.textColor }} leading-tight"
                style="font-size: clamp(3rem, 8vw + 1rem, 7.5rem);">
                {{ data.heading | raw }}
            </h2>
            {% if data.introText %}
                <div class="max-w-md font-aktiv-grotesk {{ data.textColor }} pt-2 lg:pt-4 font-light"
                     style="font-size: clamp(1.125rem, 1vw + 0.5rem, 1.5rem);">
                    {{ data.introText | raw }}
                </div>
            {% endif %}
        </div>
    </div>

{#    2. SLIDER TRACK: Strict 20px gap above cards }#}
    <div class="relative px-[20px] flex-grow flex items-start mt-[20px]">
        <div id="slider-track" class="flex gap-[12px] will-change-transform">

            {% if entry.services is defined %}
                {% for block in entry.services.all() %}
                    <div class="service-card flex-shrink-0 bg-foxplan-neutral-beige px-6 lg:px-12 flex flex-col justify-start pt-[30px] min-h-[600px] lg:min-h-[650px]
                                w-[90vw] md:w-[45vw] lg:w-[calc((100%/3)-6px)] border-r-[1px] border-foxplan-yellow last:border-none">

                        <div class="flex-grow flex flex-col justify-start">
                            <h3 class="font-serif mb-8 {{ data.textColor }}"
                                style="font-size: clamp(2rem, 2vw + 1rem, 3rem);">
                                {{ block.mainHeading | raw }}
                            </h3>

                            <div class="font-aktiv-grotesk mb-10 {{ data.textColor }} opacity-90 leading-snug font-light"
                                 style="font-size: clamp(1rem, 0.5vw + 0.8rem, 1.125rem);">
                                {{ block.bodyText | raw }}
                            </div>

                            {% if block.button is not empty %}
                                <div class="mb-12">
                                    {# INTEGRATED COMPONENT: Using the shared button component #}
                                    {{ include('_components/ui/button/button.twig', {
                                        props: {
                                            button: 'Learn More',
                                            backgroundColor: 'bg-foxplan-charcoal-brown',
                                            textColor: 'text-foxplan-neutral-beige',
                                            arrowColor: 'text-foxplan-neutral-beige'
                                        }
                                    }) }}
                                </div>
                            {% endif %}

                            {% if block.subLinks is defined and block.subLinks is not empty %}
                                <ul class="space-y-4">
                                    {% set linkLines = block.subLinks | split('\n') %}
                                    {% for line in linkLines %}
                                        {% if line | trim is not empty %}
                                            {% set parts = line | split('|') %}
                                            {% set linkText = parts[0] | trim %}
                                            {% set linkUrl = parts[1] is defined ? parts[1] | trim : '#' %}
                                            <li>
                                                <a href="{{ linkUrl }}" class="font-aktiv-grotesk {{ data.textColor }} hover:underline block opacity-80 hover:opacity-100 transition-all font-light"
                                                   style="font-size: clamp(1.125rem, 1vw + 0.5rem, 1.25rem);">
                                                    {{ linkText }}
                                                </a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="min-w-[40px] flex-shrink-0"></div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger);
        const section = document.querySelector('#services-horizontal-section');
        const track = document.querySelector('#slider-track');
        const getScrollDistance = () => track.scrollWidth - window.innerWidth + 40;

        gsap.to(track, {
            x: () => -getScrollDistance(),
            ease: "none",
            scrollTrigger: {
                trigger: section,
                pin: true,
                start: "top top",
                end: () => "+=" + getScrollDistance(),
                scrub: 1,
                invalidateOnRefresh: true,
            }
        });
    });
</script>