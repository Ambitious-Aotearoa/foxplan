{# _sections/equity-partners/equity-partners.twig #}

{# Content Fetching #}
{% set heading = entry.paragraphHeading %}
{% set description = entry.mediumParagraph %}
{% set heading2 = entry.paragraphHeading2 %}
{% set body2 = entry.bodyText2 %}
{% set heading3 = entry.paragraphHeading3 %}
{% set body3 = entry.bodyText3 %}

{# Dynamic Image Fetching from Craft Asset Fields #}
{% set imgMain = entry.image.one() %}
{% set imgSec2 = entry.image2.one() %}
{% set imgSec3 = entry.image3.one() %}

{# Fallback Hardcoded Paths for Local Development without Vite #}
{% set fallbackMain = alias('@web/dist/images/About_1.jpg') %}
{% set fallbackSec2 = alias('@web/dist/images/About_2.jpg') %}
{% set fallbackSec3 = alias('@web/dist/images/About_3.jpg') %}

<section class="relative w-full bg-foxplan-neutral-beige overflow-hidden" id="equity-partners-section">

    {# --- ANIMATED DOTTED LINE & MOVING DOT --- #}
    <div class="hidden md:block absolute left-1/2 -translate-x-1/2 top-0 bottom-0 w-[2px] z-50 pointer-events-none">
        <div class="h-full w-full border-l-2 border-dashed border-foxplan-charcoal-brown/10"></div>
        <div id="progress-line"
             class="absolute top-0 left-0 w-full border-l-2 border-dashed border-foxplan-charcoal-brown transition-all duration-75 ease-out"
             style="height: 0%;"></div>
        <div id="scrolling-dot"
             class="absolute left-1/2 -translate-x-1/2 top-0 w-3 h-3 bg-foxplan-charcoal-brown rounded-full shadow-sm opacity-0 transition-opacity duration-300"
             style="transform: translate(-50%, -50%);">
        </div>
    </div>

    <div class="w-full relative z-10">

        {# --- SECTION 1: HERO --- #}
        <div class="grid grid-cols-1 md:grid-cols-2 items-start mt-[200px]">
            <div class="w-full">
                <div class="w-full max-w-[85%] aspect-[5/4] overflow-hidden">
                    {# Priority: Asset Field -> Static Fallback #}
                    <img src="{{ imgMain ? imgMain.url : fallbackMain }}"
                         alt="{{ imgMain ? imgMain.title : 'Equity Partners' }}"
                         class="w-full h-full object-cover">
                </div>
            </div>

            <div class="flex flex-col items-end pt-0">
                <div class="w-full md:w-[75%] lg:w-[70%] mr-[20px]">
                    <h2 class="font-sterling text-[50px] text-foxplan-charcoal-brown mb-8 leading-[0.8] m-0 p-0">
                        {{ heading }}
                    </h2>
                    <div class="font-montreal font-light text-[24px] text-foxplan-charcoal-brown mb-4 leading-relaxed">
                        {{ description|raw }}
                    </div>
                    <div class="w-full mt-4">
                        {{ include('_components/ui/accordion/accordion-2.twig') }}
                    </div>
                </div>
            </div>
        </div>

        {# --- VERTICAL SPACER --- #}
        <div class="w-full mt-[250px]"></div>

        {# --- LOWER STAGGERED GRID --- #}
        <div class="grid grid-cols-1 md:grid-cols-2 items-start">

            {# LEFT COLUMN: Section 2 Text & Section 3 Image #}
            <div class="flex flex-col items-start pt-0">
                <div class="pl-[20px] pr-8 md:pr-12 lg:pr-24">
                    <h2 class="font-sterling text-[50px] text-foxplan-charcoal-brown mb-16 leading-[1.1] m-0 p-0">
                        {{ heading2 }}
                    </h2>
                    <div class="font-montreal font-light text-[20px] text-foxplan-charcoal-brown leading-relaxed max-w-md">
                        {{ body2|raw }}
                    </div>
                </div>

                <div class="w-full max-w-[85%] mt-[450px]">
                    <div class="w-full aspect-[4/3] overflow-hidden shadow-sm">
                        <img src="{{ imgSec3 ? imgSec3.url : fallbackSec3 }}"
                             class="w-full h-full object-cover"
                             alt="{{ imgSec3 ? imgSec3.title : 'Equity Partners' }}">
                    </div>
                </div>
            </div>

            {# RIGHT COLUMN: Section 2 Image & Centered Section 3 Text #}
            <div class="flex flex-col items-end pt-0">
                <div class="w-full max-w-[75%] lg:max-w-[70%] mb-48">
                    <div class="w-full aspect-[4/5] overflow-hidden shadow-sm">
                        <img src="{{ imgSec2 ? imgSec2.url : fallbackSec2 }}"
                             class="w-full h-full object-cover"
                             alt="{{ imgSec2 ? imgSec2.title : 'Equity Partners' }}">
                    </div>
                </div>

                <div class="w-full flex justify-center md:justify-end">
                    <div class="w-full md:w-[75%] lg:w-[70%] mr-[20px] mt-[50px]">
                        <h2 class="font-sterling text-[50px] text-foxplan-charcoal-brown mb-16 leading-[1.1] m-0 p-0 text-left">
                            {{ heading3 }}
                        </h2>
                        <div class="font-montreal font-light text-[20px] text-foxplan-charcoal-brown leading-relaxed text-left">
                            {{ body3|raw }}
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('equity-partners-section');
        const dot = document.getElementById('scrolling-dot');
        const progressLine = document.getElementById('progress-line');

        function updateTimeline() {
            if (!container || !dot || !progressLine) return;
            const containerRect = container.getBoundingClientRect();
            const viewHeight = window.innerHeight;

            let scrollProgress = (viewHeight / 2 - containerRect.top) / containerRect.height;

            if (scrollProgress > 0.02 && scrollProgress < 0.98) {
                dot.style.opacity = "1";
            } else {
                dot.style.opacity = "0";
            }

            scrollProgress = Math.max(0, Math.min(1, scrollProgress));
            const percentage = scrollProgress * 100;

            dot.style.top = percentage + '%';
            progressLine.style.height = percentage + '%';
        }

        window.addEventListener('scroll', updateTimeline);
        window.addEventListener('resize', updateTimeline);
        updateTimeline();
    });
</script>