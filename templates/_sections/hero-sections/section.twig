{# templates/_sections/content-sections/home-guide.twig #}

{# 1. Map Backend Data using confirmed handles #}
{% set sectionImage = entry.image.one() %}

{# Fetching the link from the 'buttonUrl' field seen in Screenshot 3.45.06pm #}
{% set rawUrl = entry.buttonUrl ?? '' %}

{# Process the URL: if it's a slug, convert to a full site URL #}
{% set finalUrl = rawUrl ? url(rawUrl) : '' %}

{% set defaults = {
    title: entry.paragraphHeading2 ?? 'Get the First Home Buyers Guide',
    bodyText: entry.bodyText2 ?? '',
    buttonText: entry.button2 ?? '',
    imageSrc: sectionImage ? sectionImage.url : null,
    buttonUrl: finalUrl,
    backgroundColor: 'bg-foxplan-yellow',
    textColor: 'text-foxplan-charcoal-brown',
    buttonBgColor: 'bg-foxplan-charcoal-brown',
    buttonTextColor: 'text-foxplan-yellow',
    borderColor: 'border-foxplan-charcoal-brown'
} %}

{% set data = defaults | merge(props ?? {}) %}

<section class="{{ data.backgroundColor }} w-full overflow-hidden border-t {{ data.borderColor }}">
    {# Maintained consistent 80px extra spacing for desktop #}
    <div class="px-4 md:px-6 lg:px-8 py-12 lg:py-16 lg:pt-32 lg:pb-32">
        <div class="flex flex-wrap md:flex-nowrap w-full items-center gap-0">

            {# Left Column: 30% Width #}
            <div class="w-full md:w-[30%] mb-12 md:mb-0 pr-8 lg:pr-12">
                <div class="max-w-md">
                    <h2 class="font-serif tracking-tight {{ data.textColor }} break-normal {{ (data.bodyText or data.buttonText) ? 'mb-8' : '' }}"
                        style="font-size: clamp(2.25rem, 4vw + 1rem, 4.5rem); line-height: 0.85; word-break: keep-all;">
                        {{ data.title | raw }}
                    </h2>

                    {% if data.bodyText is not empty %}
                        <div class="font-aktiv opacity-90 {{ data.textColor }} font-medium {{ data.buttonText ? 'mb-10' : '' }}"
                             style="font-size: clamp(0.9rem, 0.4vw + 0.8rem, 1.1rem); line-height: 1.4;">
                            {{ data.bodyText | raw }}
                        </div>
                    {% endif %}

                    {% if data.buttonText is not empty %}
                        {# The button now pulls the dynamic finalUrl #}
                        <div class="inline-block">
                            {% include '_components/ui/button/button.twig' with {
                                props: {
                                    text: data.buttonText,
                                    url: data.buttonUrl,
                                    backgroundColor: data.buttonBgColor,
                                    textColor: data.buttonTextColor,
                                    classes: 'px-10 py-4 text-[10px] tracking-[0.2em] uppercase font-aktiv font-bold rounded-none'
                                }
                            } only %}
                        </div>
                    {% endif %}
                </div>
            </div>

            {# Right Side: 70% Width #}
            <div class="w-full md:w-[70%]">
                <div class="w-full relative overflow-hidden">
                    {% set imgClasses = "w-full h-[400px] md:h-[550px] lg:h-[650px] object-cover block" %}
                    {% if data.imageSrc %}
                        <img src="{{ data.imageSrc }}" alt="{{ data.title|striptags }}" class="{{ imgClasses }}">
                    {% else %}
                        <img src="{{ craft.vite.asset('images/Insights_4.jpg') }}" alt="{{ data.title|striptags }}"
                             class="{{ imgClasses }}">
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</section>