{# templates/_components/ui/accordion/accordion-2.twig #}

{% set defaults = {
    items: [],
    defaultOpen: -1,
    textColor: 'text-foxplan-charcoal-brown',
    titleFont: 'font-serif',
    titleSize: 'text-3xl md:text-[2.6rem]',
    contentFont: 'font-aktiv-grotesk',
    contentSize: 'text-[18px] md:text-[1.1rem]',
    classes: ''
} %}

{% set props = defaults | merge(props | default({})) %}

<div
        class="relative {{ props.classes }}"
        x-data="{
        openItem: {{ props.defaultOpen }},
        hoverItem: 0,
        dotPosition: 0
    }"
        x-init="$nextTick(() => {
        let firstItem = $el.querySelector('.accordion-item');
        if(firstItem) dotPosition = firstItem.offsetTop + (firstItem.offsetHeight / 2);
    })"
>
    {# --- THE DOTTED LINE --- #}
    <div class="absolute left-2 top-0 bottom-0 w-[2px] hidden md:block">
        <div class="absolute inset-0 border-l-2 border-dotted border-foxplan-charcoal-brown opacity-20"></div>

        {# Scrolling Circle #}
        <div
                class="absolute left-[-5px] transition-all duration-500 ease-in-out"
                :style="`top: ${dotPosition}px;`"
        >
            <div class="w-3 h-3 bg-foxplan-charcoal-brown rounded-full"></div>
        </div>
    </div>

    {# --- ACCORDION WRAPPER (Reduced Spacing) --- #}
    <div class="pl-6 md:pl-12 pr-8 md:pr-12 w-full">
        {% if props.items and props.items|length > 0 %}
            {% for item in props.items %}
                {% set hasContent = item.ExpandableBodyText is not empty %}

                <div
                        class="accordion-item transition-all duration-300 ease-out relative w-full border-none mb-1"
                        :class="{ 'bg-white': hoverItem === {{ loop.index0 }} }"
                        @mouseenter="
                        hoverItem = {{ loop.index0 }};
                        dotPosition = $el.offsetTop + ($el.offsetHeight / 2);
                    "
                >
                    <button
                            class="w-full py-8 text-left group"
                            @click="openItem = openItem === {{ loop.index0 }} ? -1 : {{ loop.index0 }}"
                    >
                        <h3 class="{{ props.titleFont }} {{ props.titleSize }} {{ props.textColor }} font-light transition-transform duration-300 group-hover:translate-x-2">
                            {{ item.expandableHeadingTitle|default('Item ' ~ loop.index) }}
                        </h3>
                    </button>

                    {% if hasContent %}
                        <div x-show="openItem === {{ loop.index0 }}" x-collapse style="display: none;">
                            <div class="pb-10 w-full">
                                <div class="{{ props.contentFont }} {{ props.contentSize }} {{ props.textColor }}/80 leading-relaxed max-w-none">
                                    {{ item.ExpandableBodyText|raw }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>